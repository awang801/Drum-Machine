<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: MyBufferLoader.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: MyBufferLoader.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @author html5rocks
 * @author John McCain &lt;johnm.freestate@gmail.com>
 * @version 2.0
 * NOTE: This file is a modified version of this file so it can handle 2d arrays of buffers: http://www.html5rocks.com/en/tutorials/webaudio/intro/js/buffer-loader.js
 */

/**
 * Loads a 2d array of buffers from a 2d array of URLs
 * @constructor
 * @param {AudioContext} context - The AudioContext to load the buffers within
 * @param {Array} urlList - A 2d array of URLs to load.  Each primary index should be a list of the files for a particular instrument's buffers
 * @param {function} callback - The function to call upon completion
 */
function MyBufferLoader(context, urlList, callback)
{
  this.context = context;
  this.urlList = urlList;
  this.onload = callback;
  this.bufferList = new Array([]);

  //The number of buffers loaded so far. Used to keep track of when the loading is finished.
  this.loadCount = 0;

  //The total number of buffers to be loaded.  Used to keep track of when the loading is finished.
  this.loadMax = 0;

  for(var i = 0; i &lt; this.urlList.length; ++i)
  {
    for(var j = 0; j &lt; this.urlList[i].length; ++j)
    {
      ++this.loadMax;
    }
  }

}

/**
 * Loads an individual buffer
 * @param {string} url - The URL of the buffer to load
 * @param {number} i - The primary index (instrument index) the buffer should be placed at in the output array
 * @param {number} j - The secondary index the buffer should be placed at in the output array
 */
MyBufferLoader.prototype.loadBuffer = function(url, i, j)
{
  // Load buffer asynchronously
  var request = new XMLHttpRequest();
  request.open("GET", url, true);
  request.responseType = "arraybuffer";

  var loader = this;

  request.onload = function()
  {
    // Asynchronously decode the audio file data in request.response
    loader.context.decodeAudioData(
      request.response,
      function(buffer)
      {
        if (!buffer)
        {
          alert('error decoding file data: ' + url);
          return;
        }
        loader.bufferList[i][j] = buffer;
        if (++loader.loadCount == loader.loadMax)
          loader.onload(loader.bufferList);
      },
      function(error)
      {
        console.error('decodeAudioData error', error);
      }
    );
  }

  request.onerror = function() {
    alert('MyBufferLoader: XHR error');
  }

  request.send();
}

/**
 * Initiates the loading process
 */
MyBufferLoader.prototype.load = function()
{
  for(var i = 0; i &lt; this.urlList.length; ++i)
  {
    this.bufferList[i] = new Array();
    for(var j = 0; j &lt; this.urlList[i].length; ++j)
    {
      this.loadBuffer(this.urlList[i][j], i, j);
    }
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Instrument.html">Instrument</a></li><li><a href="Knob.html">Knob</a></li><li><a href="MyBufferLoader.html">MyBufferLoader</a></li></ul><h3>Global</h3><ul><li><a href="global.html#audioContext">audioContext</a></li><li><a href="global.html#changeBeat">changeBeat</a></li><li><a href="global.html#getBufferIndex">getBufferIndex</a></li><li><a href="global.html#knobbify">knobbify</a></li><li><a href="global.html#leds">leds</a></li><li><a href="global.html#makeKnob">makeKnob</a></li><li><a href="global.html#onBeat">onBeat</a></li><li><a href="global.html#onBeatClick">onBeatClick</a></li><li><a href="global.html#playSound">playSound</a></li><li><a href="global.html#selectInstrument">selectInstrument</a></li><li><a href="global.html#setup">setup</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#updateLeds">updateLeds</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Apr 07 2016 19:37:13 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
